# AITrade_MT5 项目文档

## 项目概述

AITrade_MT5 是一个基于Python的MetaTrader 5(MT5)交易连接程序，用于建立和管理与MT5交易平台的连接。该项目提供了完整的日志记录系统和账户信息获取功能，为自动化交易系统提供基础架构支持。

### 主要技术栈
- **Python 3.13**
- **MetaTrader5 API** - MT5平台连接库
- **标准logging库** - 日志记录系统
- **RotatingFileHandler** - 日志文件轮转管理

## 项目结构

```
AITrade_MT5/
├── main.py                 # 主程序入口
├── requirements.txt        # 项目依赖
├── config/                 # 配置模块
│   ├── __init__.py
│   └── logging_config.py   # 日志配置
├── MT5/                    # MT5连接模块
│   ├── __init__.py
│   └── mt5_init.py         # MT5初始化和连接功能
├── utils/                  # 工具模块
│   ├── __init__.py
│   └── logger.py           # 日志工具
└── logs/                   # 日志文件目录
    ├── app_YYYY-MM-DD.log      # 应用程序日志
    ├── trading_YYYY-MM-DD.log  # 交易相关日志
    └── error_YYYY-MM-DD.log    # 错误日志
```

## 构建和运行

### 安装依赖
```bash
pip install -r requirements.txt
```

### 运行程序
```bash
python main.py
```

### 停止程序
程序运行后会保持连接状态，使用 `Ctrl+C` 手动关闭连接并退出程序。

## 核心功能

### MT5连接管理
- **initialize_mt5()**: 初始化MT5连接
- **login_mt5()**: 登录交易账户
- **check_connection()**: 检查连接状态
- **shutdown_mt5()**: 关闭连接

### 信息获取
- **get_account_info()**: 获取账户信息（余额、净值、保证金等）
- **get_terminal_info()**: 获取终端信息（版本、路径等）

### 日志系统
项目使用分层日志系统，支持三种日志类型：
- **应用程序日志** (`app_logger`): 记录应用程序运行状态
- **交易日志** (`trading_logger`): 记录交易相关操作
- **错误日志** (`error_logger`): 记录错误和异常

日志文件按日期轮转，每个文件最大10MB，保留5个备份文件。

## 开发约定

### 代码风格
- 使用类型提示 (Type Hints)
- 遵循Python PEP 8编码规范
- 函数和类包含详细的中文文档字符串

### 重要规则
- **不要编写任何测试文件、测试代码、文档，除非用户强烈要求**
- 优先编辑现有文件而不是创建新文件
- 除非明确要求，否则不要主动创建文档文件(*.md)或README文件

### 错误处理
- 所有MT5操作都包含异常处理
- 使用统一的异常记录函数 `log_exception()`
- 函数返回Optional类型或Tuple来指示操作结果

### 日志规范
- 使用专门的日志记录器而非print语句
- 日志消息使用中文，包含上下文信息
- 关键操作记录详细日志，调试信息使用DEBUG级别

## 测试和验证

程序运行后会显示以下信息验证连接状态：
1. MT5终端信息（名称、版本、公司）
2. 账户信息（账号、服务器、余额、净值等）
3. 连接状态确认

## 扩展建议

1. **交易功能**: 添加下单、平仓、修改订单等交易功能
2. **市场数据**: 获取实时报价、历史数据等功能
3. **策略模块**: 集成交易策略框架
4. **配置文件**: 使用外部配置文件管理账户信息
5. **定时任务**: 添加定时执行交易操作的功能

## 注意事项

1. 程序需要MT5终端已安装并运行
2. 确保MT5终端启用了"允许算法交易"选项
3. 首次运行可能需要手动登录MT5账户
4. 日志目录会自动创建，确保有足够的磁盘空间